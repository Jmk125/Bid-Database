<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard - Bid Database</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <nav class="main-nav">
        <div class="nav-left">
            <h1>Bid Database <span style="font-size: 0.75rem; font-weight: normal; color: #95a5a6;">v3.0</span></h1>
            <ul>
                <li><a href="index.html">Projects</a></li>
                <li><a href="compare.html">Compare</a></li>
                <li><a href="dashboard.html" class="active">Dashboard</a></li>
                <li><a href="bidders.html">Bidders</a></li>
                <li><a href="other-tools.html">Other Tools</a></li>
            </ul>
        </div>
        <button type="button" class="edit-lock-toggle" data-edit-lock-toggle aria-pressed="false">ðŸ”’ Locked</button>
    </nav>

    <div class="container">
        <div class="header">
            <h2>Cross-Project Dashboard</h2>
        </div>

        <div class="filter-bar" aria-label="Project date range filters">
            <div class="filter-group">
                <label for="startDate">From</label>
                <input type="date" id="startDate" name="startDate">
            </div>
            <div class="filter-group">
                <label for="endDate">To</label>
                <input type="date" id="endDate" name="endDate">
            </div>
            <div class="filter-group">
                <label for="countyFilter">County</label>
                <select id="countyFilter" name="countyFilter">
                    <option value="">All counties</option>
                </select>
            </div>
            <div class="filter-group">
                <label for="sizeRange">Project Size</label>
                <select id="sizeRange" name="sizeRange">
                    <option value="">All project sizes</option>
                </select>
            </div>
            <div class="filter-actions">
                <button type="button" class="btn btn-primary btn-small" id="projectFilterButton">Projects (loadingâ€¦)</button>
                <button type="button" class="btn btn-secondary btn-small" id="clearDateFilter">Clear</button>
            </div>
            <div class="filter-status" id="dateFilterStatus" role="status" aria-live="polite">
                Showing all project history.
            </div>
        </div>

        <!-- Summary Metrics -->
        <div class="metrics-grid" id="summaryMetrics">
            <div class="metric-card">
                <h4>Total Projects</h4>
                <div class="value" id="totalProjects">0</div>
            </div>
            <div class="metric-card">
                <h4>Total Packages</h4>
                <div class="value" id="totalPackages">0</div>
            </div>
            <div class="metric-card">
                <h4>Total Bidders</h4>
                <div class="value" id="totalBidders">0</div>
            </div>
            <div class="metric-card">
                <h4>Total Bids</h4>
                <div class="value" id="totalBids">0</div>
            </div>
        </div>

        <!-- CSI Division Analysis -->
        <div class="table-container" style="margin-top: 2rem;">
            <div class="table-header">
                <div>
                    <h3 style="margin-bottom: 0.25rem;">Cost/SF by CSI Division</h3>
                    <p style="color: #7f8c8d; margin: 0;">Aggregate metrics across all projects</p>
                </div>
                <div class="table-controls">
                    <label for="divisionBasis" class="control-label">Cost basis</label>
                    <select id="divisionBasis" aria-label="Division cost basis">
                        <option value="selected">Selected amounts</option>
                        <option value="median">Median bids</option>
                        <option value="low">Low bids</option>
                    </select>
                </div>
            </div>
            <table id="divisionsTable">
                <thead>
                    <tr>
                        <th><button type="button" class="sortable-header" data-sort-table="divisions" data-sort-key="csi_division">CSI Division <span class="sort-indicator">â†•</span></button></th>
                        <th><button type="button" class="sortable-header" data-sort-table="divisions" data-sort-key="package_count">Package Count <span class="sort-indicator">â†•</span></button></th>
                        <th><button type="button" class="sortable-header" data-sort-table="divisions" data-sort-key="median_cost_per_sf">Median Cost/SF <span class="sort-indicator">â†•</span></button></th>
                        <th><button type="button" class="sortable-header" data-sort-table="divisions" data-sort-key="avg_cost_per_sf">Average Cost/SF <span class="sort-indicator">â†•</span></button></th>
                        <th><button type="button" class="sortable-header" data-sort-table="divisions" data-sort-key="min_cost_per_sf">Min Cost/SF <span class="sort-indicator">â†•</span></button></th>
                        <th><button type="button" class="sortable-header" data-sort-table="divisions" data-sort-key="max_cost_per_sf">Max Cost/SF <span class="sort-indicator">â†•</span></button></th>
                    </tr>
                </thead>
                <tbody id="divisionsBody">
                    <tr><td colspan="6" class="loading">Loading division data...</td></tr>
                </tbody>
            </table>
        </div>

        <div class="chart-grid" style="margin-top: 2rem;">
            <div class="chart-card" id="divisionTrendCard">
                <div class="chart-header">
                    <h3>Division Cost/SF Over Time</h3>
                    <p class="chart-subtitle">Trends for each CSI division within the active filters.</p>
                </div>
                <div id="divisionTrendChart" class="chart-canvas" aria-live="polite">Loading trendsâ€¦</div>
            </div>

            <div class="chart-card" id="medianTrendCard">
                <div class="chart-header">
                    <h3>Median Cost/SF Over Time</h3>
                    <p class="chart-subtitle">Overall median cost/SF derived from the division data.</p>
                </div>
                <div id="medianTrendChart" class="chart-canvas" aria-live="polite">Loading mediansâ€¦</div>
            </div>
        </div>

        <!-- Projects Summary -->
        <div class="table-container" style="margin-top: 2rem;">
            <h3 style="margin-bottom: 1rem;">Projects Overview</h3>
            <table id="projectsTable">
                <thead>
                    <tr>
                        <th><button type="button" class="sortable-header" data-sort-table="projects" data-sort-key="name">Project Name <span class="sort-indicator">â†•</span></button></th>
                        <th><button type="button" class="sortable-header" data-sort-table="projects" data-sort-key="building_sf">Building SF <span class="sort-indicator">â†•</span></button></th>
                        <th><button type="button" class="sortable-header" data-sort-table="projects" data-sort-key="total_cost">Total Cost <span class="sort-indicator">â†•</span></button></th>
                        <th><button type="button" class="sortable-header" data-sort-table="projects" data-sort-key="cost_per_sf">Cost/SF <span class="sort-indicator">â†•</span></button></th>
                        <th><button type="button" class="sortable-header" data-sort-table="projects" data-sort-key="package_count">Packages <span class="sort-indicator">â†•</span></button></th>
                        <th><button type="button" class="sortable-header" data-sort-table="projects" data-sort-key="project_date">Date <span class="sort-indicator">â†•</span></button></th>
                    </tr>
                </thead>
                <tbody id="projectsBody">
                    <tr><td colspan="6" class="loading">Loading projects...</td></tr>
                </tbody>
            </table>
        </div>
    </div>

    <div id="projectFilterModal" class="modal" aria-hidden="true" role="dialog" aria-labelledby="projectFilterTitle">
        <div class="modal-content modal-wide project-filter-modal">
            <span class="close" data-close-project-filter aria-label="Close project filter">&times;</span>
            <h3 id="projectFilterTitle">Project selection</h3>
            <p class="modal-subtitle">Choose which projects to include in the dashboard metrics.</p>

            <div class="project-filter-toolbar">
                <div class="project-filter-summary" id="projectFilterSummary">Toggle projects to include or exclude them from the dashboard.</div>
                <div class="project-filter-actions">
                    <button type="button" class="btn btn-secondary btn-small" id="clearProjectSelection">Exclude all</button>
                    <button type="button" class="btn btn-primary btn-small" id="selectAllProjects">Include all</button>
                </div>
            </div>

            <div id="projectFilterEmpty" class="empty-state" style="display: none;">No projects match the current filters.</div>
            <div id="projectFilterList" class="project-filter-list" role="listbox" aria-label="Filtered projects"></div>
        </div>
    </div>

    <script src="edit-key.js"></script>
    <script src="dashboard.js"></script>
</body>
</html>
