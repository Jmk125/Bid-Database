<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Compare Projects - Bid Database</title>
    <link rel="stylesheet" href="styles.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js@3.9.1/dist/chart.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels@2.0.0"></script>
</head>
<body>
    <nav class="main-nav">
        <div class="nav-left">
            <h1>Bid Database <span style="font-size: 0.75rem; font-weight: normal; color: #95a5a6;">v3.0</span></h1>
            <ul>
                <li><a href="index.html">Projects</a></li>
                <li><a href="compare.html" class="active">Compare</a></li>
                <li><a href="dashboard.html">Dashboard</a></li>
                <li><a href="bidders.html">Bidders</a></li>
                <li><a href="other-tools.html">Other Tools</a></li>
            </ul>
        </div>
        <button type="button" class="edit-lock-toggle" data-edit-lock-toggle aria-pressed="false">ðŸ”’ Locked</button>
    </nav>

    <div class="container">
        <div class="header">
            <div>
                <h2>Project Comparison</h2>
                <p style="color: #7f8c8d; margin-top: 0.5rem; max-width: 720px;">Pick one or more projects to see their totals, cost per SF, and bid mix side-by-side. Use this view to spot trends and benchmark upcoming work.</p>
            </div>
        </div>

        <section class="compare-controls">
            <div class="form-group">
                <label for="projectSelector">Projects to compare</label>
                <select id="projectSelector" multiple size="6"></select>
                <small class="form-hint">Hold Ctrl/âŒ˜ to select multiple projects.</small>
                <button type="button" class="btn btn-small estimate-add-btn" id="addEstimateBtn">+ Estimated Project</button>
                <div id="estimatedProjectList" class="estimated-project-list"></div>
            </div>
            <div class="form-group">
                <label for="compareMetric">Bar chart metric</label>
                <select id="compareMetric">
                    <option disabled selected>Loading metrics...</option>
                </select>
                <small class="form-hint" id="metricDescription">Total value of the selected bidders.</small>
            </div>
            <div class="form-group package-filter-group" id="packageFilterGroup" hidden>
                <label>Bid package filter</label>
                <details class="package-filter-dropdown">
                    <summary class="package-filter-summary" id="packageFilterSummary">Showing 0 of 0 packages</summary>
                    <div class="package-filter-toolbar">
                        <span class="package-filter-helper">Select packages to include.</span>
                        <div class="package-filter-actions">
                            <button type="button" class="btn btn-secondary btn-small" id="packageFilterAll">All</button>
                            <button type="button" class="btn btn-secondary btn-small" id="packageFilterNone">None</button>
                        </div>
                    </div>
                    <div class="package-filter-list" id="packageFilterList"></div>
                </details>
                <small class="form-hint">Expand to filter packages included in the bar chart.</small>
            </div>
            <div class="form-group">
                <label for="compareChartView">Bar chart view</label>
                <select id="compareChartView">
                    <option value="project" selected>By project (recent to oldest)</option>
                    <option value="month">By month (newest to oldest)</option>
                </select>
                <small class="form-hint" id="chartViewHint">Switch between per-project and per-month bars.</small>
            </div>
            <div class="form-group">
                <label for="pieDataset">Pie chart data</label>
                <select id="pieDataset">
                    <option value="median">Median bids</option>
                    <option value="selected">Selected bids</option>
                    <option value="low">Low bids</option>
                </select>
                <small class="form-hint">Choose which bid values to visualize.</small>
            </div>
            <div class="form-group">
                <label for="pieGrouping">Pie chart grouping</label>
                <select id="pieGrouping">
                    <option value="division">By CSI division</option>
                    <option value="category" selected>By category</option>
                </select>
                <small class="form-hint">Match the project detail pie charts by toggling between divisions or standard categories.</small>
            </div>
            <div class="form-group package-filter-group" id="packageFilterGroup" hidden>
                <label>Bid package filter</label>
                <details class="package-filter-dropdown">
                    <summary class="package-filter-summary" id="packageFilterSummary">Showing 0 of 0 packages</summary>
                    <div class="package-filter-toolbar">
                        <span class="package-filter-helper">Select packages to include.</span>
                        <div class="package-filter-actions">
                            <button type="button" class="btn btn-secondary btn-small" id="packageFilterAll">All</button>
                            <button type="button" class="btn btn-secondary btn-small" id="packageFilterNone">None</button>
                        </div>
                    </div>
                    <div class="package-filter-list" id="packageFilterList"></div>
                </details>
                <small class="form-hint">Expand to filter packages included in the bar chart.</small>
            </div>
        </section>

        <section class="chart-card">
            <div class="chart-header">
                <h3 id="compareChartTitle">Selected Total</h3>
                <p class="chart-subtitle" id="compareChartSubtitle">Total value of the selected bidders.</p>
            </div>
            <div class="chart-container compare-chart">
                <canvas id="compareMetricChart"></canvas>
            </div>
        </section>

        <section id="comparisonResults" class="comparison-grid">
            <div class="empty-state">
                <h3>Select projects to compare</h3>
                <p>Pick at least one project from the list above to see their metrics and bid mix.</p>
            </div>
        </section>
    </div>

    <div id="estimateModal" class="modal">
        <div class="modal-content modal-wide">
            <span class="close" id="closeEstimateModal">&times;</span>
            <h3>Add Estimated Project</h3>
            <p class="modal-subtitle">Paste bid package labels and amounts from an open spreadsheet.</p>
            <div class="form-group">
                <label for="estimateName">Project name</label>
                <input type="text" id="estimateName" placeholder="e.g. New School Estimate">
            </div>
            <div class="form-group">
                <label for="estimateSf">Building square footage</label>
                <input type="number" id="estimateSf" placeholder="e.g. 45000" min="0">
            </div>
            <div class="form-group">
                <label for="estimatePasteArea">Package data</label>
                <textarea id="estimatePasteArea" rows="6" placeholder="Select two columns in your spreadsheet (labels + amounts), copy, and paste here."></textarea>
                <small class="form-hint">Each row: a package label and dollar amount separated by a tab. Tip: select both columns in Excel, copy, then paste.</small>
            </div>
            <div id="estimatePreview" class="estimate-preview" hidden>
                <label>Preview</label>
                <div class="estimate-preview-table-wrap">
                    <table id="estimatePreviewTable"></table>
                </div>
                <p id="estimatePreviewSummary" class="form-hint"></p>
            </div>
            <div class="form-actions">
                <button type="button" class="btn btn-secondary" id="cancelEstimateBtn">Cancel</button>
                <button type="button" class="btn btn-primary" id="confirmEstimateBtn" disabled>Add to Comparison</button>
            </div>
        </div>
    </div>

    <script src="edit-key.js"></script>
    <script src="compare.js"></script>
</body>
</html>
